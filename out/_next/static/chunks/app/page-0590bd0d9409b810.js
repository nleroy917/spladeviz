(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6251:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>$});var s=r(5155),a=r(2115),n=r(7321),l=r(2821),o=r(5889);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.QP)((0,l.$)(t))}let d=a.forwardRef((e,t)=>{let{className:r,orientation:a="horizontal",decorative:l=!0,...o}=e;return(0,s.jsx)(n.b,{ref:t,decorative:l,orientation:a,className:i("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",r),...o})});d.displayName=n.b.displayName;var c=r(2455),u=r(4033),m=r(2108),x=r(5917);let f=c.bL;c.YJ;let p=c.WT,h=a.forwardRef((e,t)=>{let{className:r,children:a,...n}=e;return(0,s.jsxs)(c.l9,{ref:t,className:i("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...n,children:[a,(0,s.jsx)(c.In,{asChild:!0,children:(0,s.jsx)(u.A,{className:"h-4 w-4 opacity-50"})})]})});h.displayName=c.l9.displayName;let g=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(c.PP,{ref:t,className:i("flex cursor-default items-center justify-center py-1",r),...a,children:(0,s.jsx)(m.A,{className:"h-4 w-4"})})});g.displayName=c.PP.displayName;let v=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(c.wn,{ref:t,className:i("flex cursor-default items-center justify-center py-1",r),...a,children:(0,s.jsx)(u.A,{className:"h-4 w-4"})})});v.displayName=c.wn.displayName;let b=a.forwardRef((e,t)=>{let{className:r,children:a,position:n="popper",...l}=e;return(0,s.jsx)(c.ZL,{children:(0,s.jsxs)(c.UC,{ref:t,className:i("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:n,...l,children:[(0,s.jsx)(g,{}),(0,s.jsx)(c.LM,{className:i("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,s.jsx)(v,{})]})})});b.displayName=c.UC.displayName,a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(c.JU,{ref:t,className:i("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...a})}).displayName=c.JU.displayName;let N=a.forwardRef((e,t)=>{let{className:r,children:a,...n}=e;return(0,s.jsxs)(c.q7,{ref:t,className:i("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(c.VF,{children:(0,s.jsx)(x.A,{className:"h-4 w-4"})})}),(0,s.jsx)(c.p4,{children:a})]})});N.displayName=c.q7.displayName,a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(c.wv,{ref:t,className:i("-mx-1 my-1 h-px bg-muted",r),...a})}).displayName=c.wv.displayName;var y=r(2990);let j=y.Kq,k=y.bL,w=y.l9,E=a.forwardRef((e,t)=>{let{className:r,sideOffset:a=4,...n}=e;return(0,s.jsx)(y.UC,{ref:t,sideOffset:a,className:i("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",r),...n})});E.displayName=y.UC.displayName;let R=[{id:"Xenova/bert-base-uncased",label:"BERT Base",isSpladeNative:!1,hasOnnxWeights:!0},{id:"Xenova/distilbert-base-uncased",label:"DistilBERT Base",isSpladeNative:!1,hasOnnxWeights:!0},{id:"naver/splade-cocondenser-ensembledistil",label:"SPLADE CoCo Distil",isSpladeNative:!0,hasOnnxWeights:!1},{id:"naver/splade-v3",label:"SPLADE v3",isSpladeNative:!0,hasOnnxWeights:!1}],I="Xenova/distilbert-base-uncased";var S=r(3101);let C=(0,S.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function D(e){let{className:t,variant:r,...a}=e;return(0,s.jsx)("div",{className:i(C({variant:r}),t),...a})}function O(e){let{modelId:t,loadStatus:r,fromCache:a}=e,n=R.find(e=>e.id===t);if("error"===r)return(0,s.jsx)(D,{variant:"destructive",children:"Error"});if("loading"===r)return(0,s.jsx)(D,{variant:"secondary",className:"animate-pulse",children:"Loading…"});if("loaded"===r){let e=(null==n?void 0:n.isSpladeNative)?"SPLADE-trained":"Standard MLM";return(0,s.jsxs)("div",{className:"flex gap-1.5 items-center",children:[(0,s.jsx)(D,{variant:(null==n?void 0:n.isSpladeNative)?"default":"secondary",className:(null==n?void 0:n.isSpladeNative)?"bg-emerald-600 hover:bg-emerald-700":"",children:e}),a&&(0,s.jsx)(D,{variant:"outline",className:"text-xs text-muted-foreground",children:"Cached"})]})}return null}function L(e){let{modelId:t,loadStatus:r,fromCache:a,onModelChange:n}=e;return(0,s.jsx)("header",{className:"border-b border-border px-6 py-4",children:(0,s.jsxs)("div",{className:"max-w-5xl mx-auto flex items-center justify-between gap-4 flex-wrap",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-semibold tracking-tight",children:"SPLADE Visualizer"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-0.5",children:"Sparse lexical expansion in the browser via transformers.js"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(O,{modelId:t,loadStatus:r,fromCache:a}),(0,s.jsx)(j,{children:(0,s.jsxs)(f,{value:t,onValueChange:n,children:[(0,s.jsx)(h,{className:"w-52",children:(0,s.jsx)(p,{placeholder:"Select model"})}),(0,s.jsx)(b,{children:R.map(e=>{let t;return e.hasOnnxWeights?(0,s.jsx)(N,{value:e.id,children:e.label},e.id):(0,s.jsxs)(k,{children:[(0,s.jsx)(w,{asChild:!0,children:(0,s.jsxs)("div",{className:"relative flex w-full cursor-not-allowed items-center rounded-sm py-1.5 pl-8 pr-2 text-sm text-muted-foreground outline-none select-none",children:[e.label," ",(0,s.jsx)("span",{className:"ml-1.5 text-xs opacity-60",children:"(No ONNX)"})]})}),(0,s.jsxs)(E,{className:"max-w-sm",children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"No ONNX weights on the Hub"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mb-2",children:"Convert locally with:"}),(0,s.jsx)("code",{className:"block text-xs bg-muted rounded px-2 py-1 font-mono break-all",children:(t=e.id,"optimum-cli export onnx --model ".concat(t," --task fill-mask ./out/"))})]})]},e.id)})})]})})]})]})})}var M=r(2467);let _=(0,S.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),T=a.forwardRef((e,t)=>{let{className:r,variant:a,size:n,asChild:l=!1,...o}=e,d=l?M.DX:"button";return(0,s.jsx)(d,{className:i(_({variant:a,size:n,className:r})),ref:t,...o})});T.displayName="Button";let A=a.forwardRef((e,t)=>{let{className:r,type:a,...n}=e;return(0,s.jsx)("input",{type:a,className:i("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...n})});A.displayName="Input";var F=r(7450);let P=a.forwardRef((e,t)=>{let{className:r,value:a,...n}=e;return(0,s.jsx)(F.bL,{ref:t,className:i("relative h-4 w-full overflow-hidden rounded-full bg-secondary",r),...n,children:(0,s.jsx)(F.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(a||0),"%)")}})})});function z(e){let{loadStatus:t,loadProgress:r,loadProgressFile:n,inferenceStatus:l,onAnalyze:o}=e,[i,d]=(0,a.useState)("the black cat sat on the mat"),c="loaded"===t,u="running"===l;return(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("form",{onSubmit:function(e){e.preventDefault(),c&&i.trim()&&!u&&o(i.trim())},className:"flex gap-2",children:[(0,s.jsx)(A,{value:i,onChange:e=>d(e.target.value),placeholder:"Enter query text…",disabled:!c||u,className:"flex-1"}),(0,s.jsx)(T,{type:"submit",disabled:!c||u||!i.trim(),children:u?"Analyzing…":"Analyze"})]}),"loading"===t&&(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(P,{value:r,className:"h-1.5"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:n?"Downloading ".concat(n.split("/").pop(),"… ").concat(Math.round(r),"%"):"Initializing model…"})]}),"error"===t&&(0,s.jsx)("p",{className:"text-xs text-destructive-foreground bg-destructive/20 rounded px-2 py-1",children:"Failed to load model. Check console for details."}),"error"===l&&(0,s.jsx)("p",{className:"text-xs text-destructive-foreground bg-destructive/20 rounded px-2 py-1",children:"Inference failed. Check console for details."})]})}P.displayName=F.bL.displayName;function V(e){var t,r;let{entries:a,isHovered:n,isLocked:l,isSpecial:o}=e,i=a.length,d=null!=(r=null==(t=a[0])?void 0:t.weight)?r:1,c=l?"hsl(var(--primary))":n?"hsl(var(--primary) / 0.65)":"hsl(var(--primary) / 0.3)";if(o||0===i)return(0,s.jsx)("svg",{width:54,height:44,style:{background:"hsl(var(--muted))",border:"1.5px solid hsl(var(--border))",borderRadius:4},children:(0,s.jsx)("line",{x1:3,y1:22,x2:51,y2:22,stroke:"hsl(var(--border))",strokeWidth:"1.5"})});let u=48/i,m=Math.max(1.5,u-.8);return(0,s.jsx)("svg",{width:54,height:44,style:{background:l?"hsl(var(--primary) / 0.08)":n?"hsl(var(--primary) / 0.05)":"hsl(var(--background))",border:l?"1.5px solid hsl(var(--primary))":n?"1.5px solid hsl(var(--primary) / 0.55)":"1.5px solid hsl(var(--border))",borderRadius:4,transition:"background 150ms, border-color 150ms"},children:a.map((e,t)=>{let r=Math.max(1,e.weight/d*38);return(0,s.jsx)("rect",{x:3+t*u,y:41-r,width:m,height:r,fill:c,rx:.5},t)})})}function W(){return(0,s.jsxs)("svg",{width:"12",height:"22",viewBox:"0 0 12 22","aria-hidden":!0,children:[(0,s.jsx)("line",{x1:"6",y1:"0",x2:"6",y2:"15",stroke:"#cbd5e1",strokeWidth:"1.5"}),(0,s.jsx)("polygon",{points:"6,22 2,14 10,14",fill:"#cbd5e1"})]})}function U(e){let{tokens:t,tokenDistributions:r,hoveredIdx:a,lockedIdx:n,onHover:l,onLock:o}=e,d=t.length;return(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("div",{style:{display:"grid",minWidth:80*d},className:"mx-auto",children:[t.map((e,t)=>(0,s.jsx)("div",{className:"flex justify-center items-end px-1 pb-1",style:{minHeight:36},children:(0,s.jsx)("span",{className:i("font-mono text-xs text-center break-all leading-tight",e.isSpecial?"text-slate-400":"text-slate-700 font-medium"),children:e.token})},"str-".concat(t))),t.map((e,t)=>(0,s.jsx)("div",{onClick:()=>{e.isSpecial||o(t)},onMouseEnter:()=>{e.isSpecial||l(t)},onMouseLeave:()=>l(null),className:i("flex justify-center pb-1",!e.isSpecial&&"cursor-pointer"),title:e.isSpecial?void 0:'Click to inspect "'.concat(e.token,'" distribution'),children:(0,s.jsx)("div",{className:i("border rounded px-1.5 py-0.5 text-xs font-mono tabular-nums text-center transition-colors",n===t?"border-primary bg-primary/10 text-primary":a===t?"border-primary/40 bg-primary/5 text-slate-600":"border-slate-300 bg-white text-slate-400"),children:e.tokenId})},"id-".concat(t))),t.map((e,t)=>(0,s.jsx)("div",{className:"flex justify-center pt-1",children:(0,s.jsx)(W,{})},"arr1-".concat(t))),(0,s.jsxs)("div",{style:{gridColumn:"1 / ".concat(d+1)},className:"mx-4 my-1 border-2 border-slate-300 rounded-lg bg-slate-50 text-center py-3",children:[(0,s.jsx)("p",{className:"text-sm font-semibold text-slate-600 tracking-wide",children:"Transformer"}),(0,s.jsx)("p",{className:"text-xs text-slate-400 mt-0.5",children:"+ MLM Head"})]}),t.map((e,t)=>(0,s.jsx)("div",{className:"flex justify-center pb-1",children:(0,s.jsx)(W,{})},"arr2-".concat(t))),t.map((e,t)=>{var d;return(0,s.jsx)("div",{className:i("flex justify-center",!e.isSpecial&&"cursor-pointer"),onClick:()=>{e.isSpecial||o(t)},onMouseEnter:()=>{e.isSpecial||l(t)},onMouseLeave:()=>l(null),title:e.isSpecial?void 0:'Click to inspect "'.concat(e.token,'" distribution'),children:(0,s.jsx)(V,{entries:null!=(d=r[t])?d:[],isHovered:a===t,isLocked:n===t,isSpecial:e.isSpecial})},"spark-".concat(t))}),t.map((e,t)=>(0,s.jsx)("div",{className:"flex justify-center pt-1",children:(0,s.jsx)("span",{className:i("text-[10px] text-center px-0.5 leading-tight",e.isSpecial?"text-slate-300":"text-slate-400"),children:e.isSpecial?"":"logits"})},"lbl-".concat(t)))]})})}let G=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:i("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});G.displayName="Card";let K=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:i("flex flex-col space-y-1.5 p-6",r),...a})});K.displayName="CardHeader";let H=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:i("text-2xl font-semibold leading-none tracking-tight",r),...a})});H.displayName="CardTitle",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:i("text-sm text-muted-foreground",r),...a})}).displayName="CardDescription";let B=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:i("p-6 pt-0",r),...a})});function X(e){let{className:t,...r}=e;return(0,s.jsx)("div",{className:i("animate-pulse rounded-md bg-muted",t),...r})}function q(e){let{entries:t,maxWeight:r,highlightWords:a}=e;if(0===t.length)return(0,s.jsx)("p",{className:"text-sm text-muted-foreground italic",children:"No data."});let n=null!=r?r:Math.max(...t.map(e=>e.weight),1e-9),l=void 0!==a;return(0,s.jsx)("div",{className:"space-y-1",children:t.map((e,t)=>{let r=Math.max(e.weight/n*100,.5),o=!l||a.has(e.word);return(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm font-mono",children:[(0,s.jsx)("span",{className:"w-3 shrink-0 text-center text-[10px] text-primary",children:o&&l?"◆":""}),(0,s.jsx)("span",{className:"w-24 shrink-0 truncate text-right",style:{opacity:o?1:.35},children:e.word}),(0,s.jsx)("div",{className:"flex-1 h-4 bg-muted rounded-sm overflow-hidden",children:(0,s.jsx)("div",{className:"h-full rounded-sm transition-all duration-300",style:{width:"".concat(r,"%"),opacity:o?1:.25,backgroundColor:"hsl(var(--primary) / 0.75)"}})}),(0,s.jsx)("span",{className:"w-12 shrink-0 text-right text-xs text-muted-foreground",style:{opacity:o?1:.35},children:e.weight.toFixed(3)})]},t)})})}function J(e){var t;let{activeIdx:r,isLocked:a,tokens:n,tokenDistributions:l,inferenceRunning:o,winnerWords:i}=e,d=n.length>0,c=null!==r&&n[r]?n[r]:null,u=null!==r&&l[r]?l[r]:null,m=null!=(t=null==i?void 0:i.size)?t:0;return(0,s.jsxs)(G,{children:[(0,s.jsxs)(K,{className:"pb-3",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,s.jsx)(H,{className:"text-sm font-medium",children:c?(0,s.jsxs)(s.Fragment,{children:["Token “",c.token,"” — vocabulary weights"]}):"Token Distribution"}),i&&m>0&&(0,s.jsxs)("span",{className:"shrink-0 text-xs text-primary font-mono",children:["◆ ",m," in sparse vector"]})]}),i&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"◆ = this token's score was the max across all positions"})]}),(0,s.jsx)(B,{className:"overflow-y-auto",children:o?(0,s.jsx)("div",{className:"space-y-2",children:Array.from({length:8}).map((e,t)=>(0,s.jsx)(X,{className:"h-4 w-full"},t))}):d?null===c?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Click a token to see its top-K vocabulary weights."}):u?(0,s.jsx)(q,{entries:u,highlightWords:i}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground italic",children:"No weights for this token."}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Run inference then click a token to see its vocabulary weight distribution."})})]})}function Q(e){let{sparseVector:t,modelId:r,inferenceRunning:a,contributorMap:n,tokens:l,lockedTokenIdx:o}=e,i=t.length>0?Math.max(...t.map(e=>e.weight),1e-9):1,d=!!n&&!!l;return(0,s.jsxs)(G,{children:[(0,s.jsxs)(K,{className:"pb-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[(0,s.jsx)(H,{className:"text-sm font-medium",children:"Final Sparse Vector"}),t.length>0&&(0,s.jsxs)(D,{variant:"outline",className:"text-xs font-mono",children:[t.length," non-zero dims"]})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Max-pooled across all token positions \xb7 log(1 + ReLU(logits))"})]}),(0,s.jsx)(B,{className:"overflow-y-auto",children:a?(0,s.jsx)("div",{className:"space-y-2",children:Array.from({length:12}).map((e,t)=>(0,s.jsx)(X,{className:"h-4 w-full"},t))}):0===t.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Run inference to see the final max-pooled sparse retrieval vector."}):(0,s.jsx)("div",{className:"space-y-1",children:t.map((e,t)=>{var r;let a=Math.max(e.weight/i*100,.5),c=null==n?void 0:n.get(e.word),u=d&&void 0!==c?l[c]:null,m=null!=o&&c===o;return(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm font-mono",children:[(0,s.jsx)("span",{className:"w-24 shrink-0 truncate text-right",style:{opacity:m?1:.7},children:e.word}),(0,s.jsx)("div",{className:"flex-1 h-4 bg-muted rounded-sm overflow-hidden",children:(0,s.jsx)("div",{className:"h-full rounded-sm transition-all duration-300",style:{width:"".concat(a,"%"),backgroundColor:m?"hsl(var(--primary))":"hsl(var(--primary) / 0.45)"}})}),(0,s.jsx)("span",{className:"w-12 shrink-0 text-right text-xs text-muted-foreground",style:{opacity:m?1:.7},children:e.weight.toFixed(3)}),(0,s.jsx)("span",{className:"w-12 shrink-0 truncate text-xs font-mono text-right",style:{color:m?"hsl(var(--primary))":"hsl(var(--muted-foreground) / 0.5)"},title:u?'contributed by "'.concat(u.token,'"'):void 0,children:null!=(r=null==u?void 0:u.token)?r:""})]},t)})})})]})}B.displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:i("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter";let Y={modelId:I,loadStatus:"idle",loadError:null,loadProgress:0,loadProgressFile:"",fromCache:!1,vocabSize:0,inferenceStatus:"idle",inferenceError:null,tokens:[],tokenDistributions:[],sparseVector:[],hoveredTokenIdx:null,lockedTokenIdx:null};function Z(e,t){switch(t.type){case"MODEL_LOADING":return{...e,modelId:t.modelId,loadStatus:"loading",loadError:null,loadProgress:0,loadProgressFile:"",fromCache:!1,tokens:[],tokenDistributions:[],sparseVector:[],hoveredTokenIdx:null,lockedTokenIdx:null,inferenceStatus:"idle",inferenceError:null};case"LOAD_PROGRESS":return{...e,loadProgress:t.progress,loadProgressFile:t.file};case"MODEL_LOADED":return{...e,loadStatus:"loaded",modelId:t.modelId,fromCache:t.fromCache,vocabSize:t.vocabSize,loadProgress:100};case"MODEL_ERROR":return{...e,loadStatus:"error",loadError:t.message};case"INFERENCE_RUNNING":return{...e,inferenceStatus:"running",inferenceError:null};case"INFERENCE_DONE":{let r=t.tokens.findIndex(e=>!e.isSpecial);return{...e,inferenceStatus:"done",tokens:t.tokens,tokenDistributions:t.tokenDistributions,sparseVector:t.sparseVector,hoveredTokenIdx:null,lockedTokenIdx:r>=0?r:null}}case"INFERENCE_ERROR":return{...e,inferenceStatus:"error",inferenceError:t.message};case"HOVER_TOKEN":return{...e,hoveredTokenIdx:t.idx};case"LOCK_TOKEN":return{...e,lockedTokenIdx:t.idx===e.lockedTokenIdx?null:t.idx};case"SET_MODEL":return{...e,modelId:t.modelId};default:return e}}function $(){let{state:e,loadModel:t,runInference:n,hoverToken:l,lockToken:o}=function(){let[e,t]=(0,a.useReducer)(Z,Y),s=(0,a.useRef)(null);(0,a.useRef)(e).current=e,(0,a.useEffect)(()=>{let e=new Worker(r.tu(new URL(r.p+r.u(983),r.b)),{type:void 0});return e.onmessage=e=>{let r=e.data;switch(r.type){case"MODEL_LOADING_PROGRESS":t({type:"LOAD_PROGRESS",file:r.file,progress:r.progress});break;case"MODEL_LOADED":t({type:"MODEL_LOADED",modelId:r.modelId,fromCache:r.fromCache,vocabSize:r.vocabSize});break;case"MODEL_ERROR":t({type:"MODEL_ERROR",message:r.message});break;case"INFERENCE_RUNNING":t({type:"INFERENCE_RUNNING"});break;case"INFERENCE_RESULT":t({type:"INFERENCE_DONE",modelId:r.modelId,tokens:r.tokens,tokenDistributions:r.tokenDistributions,sparseVector:r.sparseVector});break;case"INFERENCE_ERROR":t({type:"INFERENCE_ERROR",message:r.message})}},e.onerror=e=>{var r;t({type:"MODEL_ERROR",message:null!=(r=e.message)?r:"Worker error"})},s.current=e,t({type:"MODEL_LOADING",modelId:I}),e.postMessage({type:"LOAD_MODEL",modelId:I,dtype:"q8",device:"wasm"}),()=>{e.terminate()}},[]);let n=(0,a.useCallback)(e=>{var r;t({type:"MODEL_LOADING",modelId:e}),null==(r=s.current)||r.postMessage({type:"LOAD_MODEL",modelId:e,dtype:"q8",device:"wasm"})},[]),l=(0,a.useCallback)(e=>{s.current&&s.current.postMessage({type:"RUN_INFERENCE",text:e,topK:30,topM:50})},[]);return{state:e,loadModel:n,runInference:l,hoverToken:(0,a.useCallback)(e=>{t({type:"HOVER_TOKEN",idx:e})},[]),lockToken:(0,a.useCallback)(e=>{t({type:"LOCK_TOKEN",idx:e})},[])}}(),i=e.tokens.length>0,c=(0,a.useMemo)(()=>{let t=new Map;return e.tokenDistributions.forEach((e,r)=>{e.forEach(e=>{let s=t.get(e.word);(!s||e.weight>s.w)&&t.set(e.word,{w:e.weight,idx:r})})}),new Map([...t.entries()].map(e=>{let[t,r]=e;return[t,r.idx]}))},[e.tokenDistributions]),u=(0,a.useMemo)(()=>{let t=e.lockedTokenIdx;if(null!==t&&e.tokenDistributions[t])return new Set(e.tokenDistributions[t].filter(e=>c.get(e.word)===t).map(e=>e.word))},[e.lockedTokenIdx,e.tokenDistributions,c]);return(0,s.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,s.jsx)(L,{modelId:e.modelId,loadStatus:e.loadStatus,fromCache:e.fromCache,onModelChange:r=>{r!==e.modelId&&t(r)}}),(0,s.jsxs)("main",{className:"flex-1 max-w-6xl w-full mx-auto px-6 py-8 space-y-6",children:[(0,s.jsx)(z,{loadStatus:e.loadStatus,loadProgress:e.loadProgress,loadProgressFile:e.loadProgressFile,inferenceStatus:e.inferenceStatus,onAnalyze:n}),i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d,{}),(0,s.jsx)(U,{tokens:e.tokens,tokenDistributions:e.tokenDistributions,hoveredIdx:e.hoveredTokenIdx,lockedIdx:e.lockedTokenIdx,onHover:l,onLock:o}),null!==e.lockedTokenIdx&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsx)(J,{activeIdx:e.lockedTokenIdx,isLocked:!0,tokens:e.tokens,tokenDistributions:e.tokenDistributions,inferenceRunning:!1,winnerWords:u}),(0,s.jsx)(Q,{sparseVector:e.sparseVector,modelId:e.modelId,inferenceRunning:"running"===e.inferenceStatus,contributorMap:c,tokens:e.tokens,lockedTokenIdx:e.lockedTokenIdx})]})]})]}),(0,s.jsx)("footer",{className:"border-t border-border px-6 py-3 text-center text-xs text-muted-foreground",children:"Browser-only inference \xb7 transformers.js + WebAssembly \xb7 no data leaves your device"})]})}},6825:(e,t,r)=>{Promise.resolve().then(r.bind(r,6251))}},e=>{e.O(0,[152,441,255,358],()=>e(e.s=6825)),_N_E=e.O()}]);